And a set of datalog rules:
[?d, :is_marginal, "1"]:- [?d, :detection_of, ?t],[?d, :serial_num, ?n1],[?t, :num_of_dets, ?n2], FILTER(?n1=?n2),FILTER(?n2>1).
[?d, :is_marginal, "1"]:- [?d, :detection_of, ?t],[?d, :serial_num, ?n1],[?t, :num_of_dets, ?n2], FILTER(?n1=1),FILTER(?n2>1).
[?d1, :stop_on_time, ?d2]:-[?d1, :near_on_time, ?d2],[?d1, :is_marginal, "1"],[?d2, :is_marginal, "1"].
[?d1, :stops_near_poi, ?p]:-[?d1, :near_poi, ?p],[?d1, :is_marginal, "1"].
[?t, :near_poi, ?p]:- [?d, :detection_of, ?t],[?d, :near_poi, ?p].
[?t, :stops_near_poi, ?p]:- [?d, :detection_of, ?t],[?d, :stops_near_poi, ?p].